<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <h:form id="form">
            <p:contextMenu for="organs">
                <p:menuitem value="View" update="organDetail" icon="ui-icon-search"
                            oncomplete="PF('organDialog').show()"
                            actionListener="#{handleOrganAction.view}"/>
                <p:menuitem value="Edit" update="organDetail" icon="ui-icon-search"
                            oncomplete="PF('organDialog').show()"
                            actionListener="#{handleOrganAction.edit}"/>
                <p:menuitem value="Assign Rule" update="assignRuleDetail" icon="ui-icon-search"
                            oncomplete="PF('assignRuleDialog').show()"
                            actionListener="#{handleOrganAction.assignRule}"/>
                <p:menuitem value="Persons" update="personTable" icon="ui-icon-search"
                            oncomplete="PF('PersonDialog').show()" actionListener="#{handleOrganAction.viewPerson}"/>
                <p:menuitem value="Delete" update="organs" icon="ui-icon-close"
                            actionListener="#{handleOrganAction.doDelete}"/>
            </p:contextMenu>
            <p:tree id="tree"  var="organ" dir="RTL" value="#{handleOrganAction.rootOrgans}"
                    orientation="horizontal">
                <p:treeNode >

                    <h:outputText value="#{organ}"/>

                </p:treeNode>
            </p:tree>

            <p:commandButton value="Add" id="add" update="organDetail" actionListener="#{handleOrganAction.add}"
                             styleClass="ui-priority-primary" onclick="PF('organDialog').show()"/>

            <p:dataTable id="organs" var="currentOrgan" value="#{handleOrganAction.organList}"
                         rowKey="#{currentOrgan.id}"
                         selection="#{handleOrganAction.currentOrgan}" selectionMode="single"
                         paginator="true" rows="10"
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                         rowsPerPageTemplate="5,10,15" lazy="true"
                         draggableColumns="true" style="margin-bottom:20px">
                <f:facet name="header">
                    RightClick to View Options
                    <p:commandButton id="toggler" type="button" value="Columns" style="float:right" icon="ui-icon-calculator" />
                    <p:columnToggler datasource="organs" trigger="toggler" />
                </f:facet>

                <p:column headerText="name" sortBy="#{currentOrgan.name}" filterBy="#{currentOrgan.name}">
                    <h:outputText value="#{currentOrgan.name}"/>
                </p:column>
                <p:column headerText="code" sortBy="#{currentOrgan.code}" filterBy="#{currentOrgan.code}">
                    <h:outputText value="#{currentOrgan.code}"/>
                </p:column>
                <p:column headerText="type" sortBy="#{currentOrgan.organType.titleText}" filterBy="#{currentOrgan.organType.titleText}">
                    <h:outputText value="#{currentOrgan.organType.titleText}"/>
                </p:column>
                <p:column headerText="title" sortBy="#{currentOrgan.title}" filterBy="#{currentOrgan.title}">
                    <h:outputText value="#{currentOrgan.title}"/>
                </p:column>
            </p:dataTable>

            <p:dialog header="Organ Info" widgetVar="organDialog" modal="true" showEffect="fade" hideEffect="fade"
                      resizable="false">
                <p:outputPanel id="organDetail" style="text-align:center;">
                    <f:facet name="header">

                    </f:facet>
                    <table>
                        <tr>
                            <td>
                                <h:outputText value="name:"/>
                            </td>
                            <td>
                                <p:inputText readonly="#{handleOrganAction.disableFields}"
                                             value="#{handleOrganAction.organName}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h:outputText value="code:"/>
                            </td>
                            <td>
                                <p:inputText readonly="#{handleOrganAction.disableFields}"
                                             value="#{handleOrganAction.organCode}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h:outputText value="title:"/>
                            </td>
                            <td>
                                <p:inputText readonly="#{handleOrganAction.disableFields}"
                                             value="#{handleOrganAction.organTitle}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h:outputText value="type:"/>
                            </td>
                            <td>
                                <p:selectOneMenu value="#{handleOrganAction.organType.id}"
                                                 disabled="#{handleOrganAction.disableFields}"
                                                 valueChangeListener="#{handleOrganAction.selectOrganType}">
                                    <f:selectItems itemLabel="#{orgType.code}" itemValue="#{orgType.id}"
                                                   var="orgType"
                                                   value="#{handleOrganAction.organTypes}"/>
                                </p:selectOneMenu>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h:outputText value="inheritance:"/>
                            </td>
                            <td>
                                <p:selectBooleanCheckbox value="#{handleOrganAction.inheritance}"
                                                         disabled="#{handleOrganAction.disableFields}"
                                                         valueChangeListener="#{handleOrganAction.selectInheritance}"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <p:commandButton value="Submit" id="edit" update="organs"
                                                 actionListener="#{handleOrganAction.saveOrUpdate}"
                                                 oncomplete="PF('organDialog').hide()" styleClass="ui-priority-primary"
                                                 rendered="#{not handleOrganAction.disableFields}"/>
                            </td>
                        </tr>
                    </table>
                </p:outputPanel>
            </p:dialog>

            <p:dialog header="Persons" widgetVar="PersonDialog" modal="true" showEffect="fade" hideEffect="fade"
                      resizable="false">
                <p:outputPanel id="persons" ajaxRendered="true">
                    <table border="0" cellpadding="3" cellspacing="3" class="panelLikeTable">
                        <tr valign="top">
                            <td nowrap="nowrap">
                                <fieldset>
                                    <legend>
                                        <h:outputText escape="true" value="person_list"/>
                                    </legend>
                                    <p:dataTable id="personTable" value="#{handleOrganAction.personList}"
                                                 keepSaved="true"
                                                 noDataLabel="no_result_found"
                                                 sortMode="single"
                                                 var="person"
                                                 rows="10"
                                                 style="BORDER-COLLAPSE: collapse;text-align: center; width:100%;"
                                                 rowClasses="ROW1,ROW2">
                                        <p:column sortBy="#{person.name}"
                                                  sortOrder="#{handlePersonAction.personnameOrder}">
                                            <f:facet name="header">
                                                <p:commandLink value="name" render="personTable"
                                                               execute="@this"
                                                               limitRender="true"
                                                               action="#{handlePersonAction.sortByPersonname}"/>
                                                <br/>
                                                <h:inputText converter="persianConverter"
                                                             value="#{handlePersonAction.personnameFilter}">
                                                    <p:ajax event="blur" render="personTable" execute="@this"
                                                            limitRender="true"/>
                                                </h:inputText>
                                            </f:facet>
                                            <h:outputText escape="true" value="#{person.name}"/>
                                        </p:column>

                                        <p:column sortBy="#{person.lastName}"
                                                  sortOrder="#{handlePersonAction.personFamilyOrder}">
                                            <f:facet name="header">
                                                <p:commandLink value="lastname" render="personTable"
                                                               execute="@this"
                                                               limitRender="true"
                                                               action="#{handlePersonAction.sortByPersonFamily}"/>
                                                <br/>
                                                <h:inputText converter="persianConverter"
                                                             value="#{handlePersonAction.personFamilyFilter}">
                                                    <p:ajax event="blur" render="personTable" execute="@this"
                                                            limitRender="true"/>
                                                </h:inputText>
                                            </f:facet>
                                            <h:outputText escape="true" value="#{person.lastName}"/>
                                        </p:column>

                                        <p:column sortBy="#{person.personnelNo}"
                                                  sortOrder="#{handlePersonAction.personnelNoOrder}">
                                            <f:facet name="header">
                                                <p:commandLink value="personnelCode" render="personTable"
                                                               execute="@this"
                                                               limitRender="true"
                                                               action="#{handlePersonAction.sortByPersonnelNo}"/>
                                                <br/>
                                                <h:inputText value="#{handlePersonAction.personnelNoFilter}">
                                                    <p:ajax event="blur" render="personTable" execute="@this"
                                                            limitRender="true"/>
                                                </h:inputText>
                                            </f:facet>
                                            <h:outputText escape="true" value="#{person.personnelNo}"/>
                                        </p:column>

                                        <f:facet name="footer">
                                            <p:dataScroller limitRender="true" execute="@this" render="personTable"
                                                            page="#{handleOrganAction.personPage}"/>
                                        </f:facet>
                                    </p:dataTable>
                                </fieldset>
                            </td>
                        </tr>
                    </table>
                </p:outputPanel>

            </p:dialog>
            <p:dialog header="Assign Rule" widgetVar="assignRuleDialog" modal="true" showEffect="fade" hideEffect="fade"
                      resizable="false">
                <p:outputPanel id="assignRuleDetail" style="text-align:center;">
                    <p:dataTable id="assignRule" var="rule" value="#{handleOrganAction.rulePackageList}"
                                 selectionMode="single" selection="#{handleOrganAction.selectedRulePackage}"
                                 rowKey="#{rule.id}">
                        <f:facet name="header">
                            Select Events
                        </f:facet>
                        <p:ajax event="rowSelect" listener="#{handleOrganAction.doAssignRule}" oncomplete="PF('assignRuleDialog').hide()" update=":form:organs"/>
                        <p:column headerText="rule name">
                            <h:outputText value="#{rule.name}"/>
                        </p:column>
                        <p:column headerText="calendar name">
                            <h:outputText value="#{rule.calendar.name}"/>
                        </p:column>
                        <p:column headerText="anti pass back">
                            <h:graphicImage
                                    value="#{rule.aniPassBack ? '/images/s_true.png':'/images/s_false.png'}"/>
                        </p:column>
                        <p:column headerText="allow exit">
                            <h:graphicImage
                                    value="#{rule.allowExit ? '/images/s_true.png':'/images/s_false.png'}"/>
                        </p:column>
                        <p:column headerText="allow exit gadget">
                            <h:graphicImage
                                    value="#{rule.allowExitGadget ? '/images/s_true.png':'/images/s_false.png'}"/>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
            </p:dialog>

        </h:form>
    </ui:define>

</ui:composition>