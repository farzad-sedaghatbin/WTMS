<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">
<ui:define name="content">

<h:form id="cardList">

<p:dataTable id="cardTable"
                keepSaved="true"
                value="#{handleCardAction.cardList}"
                rowKeyVar="rowIndex"
                noDataLabel="no_result_found"
                sortMode="single"
                var="card"
                onrowmousedown="highlight(#{p:element('editLink);"
                rows="10"
                style="BORDER-COLLAPSE: collapse;text-align: center; width:100%;"
                rowClasses="ROW1,ROW2">

    <p:column sortBy="#{card.name}"
                 sortOrder="#{handleCardAction.cardNameOrder}">
        <f:facet name="header">
            <p:commandLink value="card_name" render="cardTable"
                             execute="@this"
                             limitRender="true"
                             action="#{handleCardAction.sortByCardName}"/>
            <br/>
            <h:inputText converter="persianConverter" value="#{handleCardAction.cardNameFilter}">
                <p:ajax event="blur" render="cardTable" execute="@this" limitRender="true"
                          onbeforesubmit="resetPage()"/>
            </h:inputText>
        </f:facet>
        <h:outputText escape="true" value="#{card.name}"/>
    </p:column>
    <p:column sortBy="#{card.code}"
                 sortOrder="#{handleCardAction.cardCodeOrder}">
        <f:facet name="header">
            <p:commandLink value="card_code" render="cardTable"
                             execute="@this"
                             limitRender="true"
                             action="#{handleCardAction.sortByCardCode}"/>
            <br/>
            <h:inputText value="#{handleCardAction.cardCodeFilter}" size="10">
                <p:ajax event="blur" render="cardTable" execute="@this" limitRender="true"
                          onbeforesubmit="resetPage()"/>
            </h:inputText>
        </f:facet>
        <p:commandLink id="editLink" value="#{card.code}"
                         render="operationArea"
                         styleClass="withoutUnderlineLink"
                         execute="@this"
                         limitRender="true"
                         action="#{handleCardAction.selectForEdit}"/>
    </p:column>

    <p:column >
        <f:facet name="header">
            <h:outputText escape="true" value="card_type"/>
            <br/>
            <h:inputText value="#{handleCardAction.cardTypeCodeFilter}" size="10">
                <p:ajax event="blur" render="cardTable" execute="@this" limitRender="true"
                          onbeforesubmit="resetPage()"/>
            </h:inputText>
        </f:facet>

        <h:outputText escape="true" value="#{card.cardType.code}"/>
    </p:column>

    <p:column >
        <f:facet name="header">
            <h:outputText escape="true" value="card_status"/>
            <br/>
            <h:inputText value="#{handleCardAction.cardStatusCodeFilter}" size="10">
                <p:ajax event="blur" render="cardTable" execute="@this" limitRender="true"
                          onbeforesubmit="resetPage()"/>
            </h:inputText>
        </f:facet>

        <h:outputText escape="true" value="#{card.cardStatus.code}"/>
    </p:column>

    <p:column sortBy="#{card.startDate}"
                 sortOrder="#{handleCardAction.startDateOrder}">
        <f:facet name="header">
            <p:commandLink value="startDate" render="cardTable"
                             execute="@this"
                             limitRender="true"
                             action="#{handleCardAction.sortByStartDate}"/>
            <br/>
            <h:inputText value="#{handleCardAction.startDateFilter}"
                         id="startDateFilter" style="display: none">
                <p:ajax event="change" render="cardTable, dateFilterScript"
                          execute="@this"
                          limitRender="true"/>
            </h:inputText>
            <c:persianCalendarPicker id="filterCalendar"
                                     disabled="false"
                                     converter="dateConverter"
                                     srcRemove="/WTMS/images/remove.png"
                                     src="/WTMS/images/calendar.png"
                                     styleClass="textColor"
                                     value="#{handleCardAction.startDateFilter}"
                                     localValueSet="true"/>
        </f:facet>
        <h:outputText escape="true" value="#{card.startDate}" converter="dateConverter"/>
    </p:column>

    <p:column sortBy="#{card.expirationDate}"
                 sortOrder="#{handleCardAction.expirationDateOrder}">
        <f:facet name="header">
            <p:commandLink value="expirationDate" render="cardTable"
                             execute="@this"
                             limitRender="true"
                             action="#{handleCardAction.sortByExpirationDate}"/>
            <br/>
            <h:inputText value="#{handleCardAction.expirationDateFilter}"
                         id="expirationDateFilter" style="display: none">
                <p:ajax event="change" render="cardTable, dateFilterScript1"
                          execute="@this"
                          limitRender="true"/>
            </h:inputText>

        </f:facet>
        <h:outputText escape="true" value="#{card.expirationDate}" converter="dateConverter"/>
    </p:column>

    <p:column sortBy="#{card.person.name}"
                 sortOrder="#{handleCardAction.cardOwnerNameOrder}">
        <f:facet name="header">
            <p:commandLink value="name" render="cardTable"
                             execute="@this"
                             limitRender="true"
                             action="#{handleCardAction.sortByCardOwnerName}"/>
            <br/>
            <h:inputText converter="persianConverter" value="#{handleCardAction.cardOwnerNameFilter}">
                <p:ajax event="blur" render="cardTable" execute="@this"
                          limitRender="true" onbeforesubmit="resetPage()"/>
            </h:inputText>

        </f:facet>
        <h:outputText escape="true" value="#{card.person.name}"/>
    </p:column>
    <p:column sortBy="#{card.person.lastName}"
                 sortOrder="#{handleCardAction.cardOwnerFamilyOrder}">
        <f:facet name="header">
            <p:commandLink value="lastname" render="cardTable"
                             execute="@this"
                             limitRender="true"
                             action="#{handleCardAction.sortByCardOwnerFamily}"/>
            <br/>
            <h:inputText converter="persianConverter" value="#{handleCardAction.cardOwnerFamilyFilter}">
                <p:ajax event="blur" render="cardTable" execute="@this"
                          limitRender="true" onbeforesubmit="resetPage()"/>
            </h:inputText>
        </f:facet>
        <h:outputText escape="true" value="#{card.person.lastName}"/>
    </p:column>
    <p:column sortBy="#{card.person.personnelNo}"
                 sortOrder="#{handleCardAction.cardPersonnelNoOrder}">
        <f:facet name="header">
            <p:commandLink value="personnelCode" render="cardTable"
                             execute="@this"
                             limitRender="true"
                             action="#{handleCardAction.sortByCardPersonnelNo}"/>
            <br/>
            <h:inputText value="#{handleCardAction.cardPersonnelNoFilter}" size="10">
                <p:ajax event="blur" render="cardTable" execute="@this" limitRender="true"
                          onbeforesubmit="resetPage()"/>
            </h:inputText>
        </f:facet>
        <h:outputText escape="true" value="#{card.person.personnelNo}"/>
    </p:column>

    <f:facet name="footer">
        <p:dataScroller limitRender="true" execute="@this" render="cardTable,operationArea"
                           page="#{handleCardAction.page}"/>
    </f:facet>
</p:dataTable>

</h:form>
</ui:define>
</ui:composition>
