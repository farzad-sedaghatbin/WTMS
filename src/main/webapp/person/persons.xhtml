<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">

        <p:breadCrumb>
            <p:menuitem value="category" url="#"/>
            <p:menuitem value="#{bundle.management}" url="#" />
            <p:menuitem value="#{bundle.person}" url="#" />
        </p:breadCrumb>

        <p:dialog header="#{bundle.sync}" widgetVar="selectPDP" modal="true" showEffect="fade" hideEffect="fade"
                  resizable="false">
            <ui:include src="selectlist-pdp.xhtml"/>
        </p:dialog>

        <p:dialog header="#{bundle.person}" widgetVar="PersonPanel" modal="true" showEffect="fade" hideEffect="fade"
                  resizable="false">
            <ui:include src="handle-person.xhtml"/>
        </p:dialog>

        <p:dialog header="#{bundle.assign_rule}" widgetVar="AssignRulePanel" modal="true" showEffect="fade" hideEffect="fade"
                  resizable="false">
            <ui:include src="assign-person-rule.xhtml"/>
        </p:dialog>

        <p:dialog header="#{bundle.edit_rule}" widgetVar="rulePanel" modal="true" showEffect="fade" hideEffect="fade"
                  resizable="false">
            <ui:include src="../rule/handle-rule-edit.xhtml"/>
        </p:dialog>

        <p:dialog header="#{bundle.reset_password}" widgetVar="resetPanel" modal="true" showEffect="fade" hideEffect="fade"
                  resizable="false">
            <ui:include src="reset-password.xhtml"/>
        </p:dialog>

        <p:dialog header="#{bundle.detail}" widgetVar="PersonDetailPanel" modal="true" showEffect="fade" hideEffect="fade"
                  resizable="false">
            <ui:include src="detail-person.xhtml"/>
        </p:dialog>

        <p:dialog header="#{bundle.confirmation}" widgetVar="ConfirmationPanel" modal="true" showEffect="fade" hideEffect="fade"
                  resizable="false">
            <f:facet name="header">
                &#160;
            </f:facet>
            <h:form>

                <table border="0" cellpadding="3" cellspacing="3" class="panelLikeTable">
                    <tr valign="top">
                        <td nowrap="nowrap" align="center">
                            <h:outputText escape="true" value="#{bundle.delete_message}"/>
                        </td>
                    </tr>
                    <tr valign="top">
                        <td nowrap="nowrap" align="center">
                            <p:commandButton execute="@this" limitRender="true"
                                             action="#{handlePersonAction.doDelete}"
                                             value="#{bundle.yes}"/>
                            &#160;
                            <p:commandButton execute="@this" limitRender="true" value="#{bundle.no}"
                                             oncomplete="PF('ConfirmationPanel').hide()"/>
                        </td>
                    </tr>
                </table>
            </h:form>
        </p:dialog>

        <br/>

        <h:form dir="#{me.direction}" id="frm">
                <table border="0" cellpadding="3" cellspacing="3" class="panelLikeTable">

                    <tr valign="top">
                        <td colspan="2" style="padding-bottom: 0; padding-bottom: 0">
                            <p:outputPanel id="advanceSearchID" ajaxRendered="true">
                                <table cellpadding="3" cellspacing="3" class="panelLikeTable">
                                    <tr>
                                        <td align="#{me.align}" nowrap="nowrap" valign="top" width="90%">
                                            <p:panel header="" toggleable="true" closable="true"
                                                     toggleSpeed="500" closeSpeed="500" widgetVar="panel"
                                                     style="margin-bottom:20px" dir="#{me.direction}"
                                                     collapsed="#{view.viewId eq '/list-person.xhtml'}">
                                                    <table border="0" cellpadding="3" align="#{me.appositeAlign}"
                                                           cellspacing="3"
                                                           class="panelLikeTable">

                                                        <tr valign="top">
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:selectOneMenu
                                                                        value="#{handlePersonAction.preCondition}">
                                                                    <f:selectItems
                                                                            value="#{handlePersonAction.preConditions}"/>
                                                                </h:selectOneMenu>
                                                            </td>
                                                            &#160;&#160;
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:selectOneMenu
                                                                        value="#{handlePersonAction.attributeName}">
                                                                    <f:selectItems
                                                                            value="#{handlePersonAction.attributeNames}"/>
                                                                </h:selectOneMenu>
                                                            </td>
                                                            &#160;&#160;
                                                            <td>
                                                                <h:inputText converter="persianConverter"
                                                                             value="#{handlePersonAction.attributeValue}"/>
                                                            </td>
                                                            &#160;&#160;
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:selectOneMenu
                                                                        value="#{handlePersonAction.postCondition}">
                                                                    <f:selectItems
                                                                            value="#{handlePersonAction.postConditions}"/>
                                                                </h:selectOneMenu>
                                                            </td>

                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <p:commandButton value="#{bundle.add_condition}"
                                                                                 action="#{handlePersonAction.addCondition}"
                                                                                 update="conditionTable"/>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                    <table border="0" cellpadding="3" align="#{me.appositeAlign}"
                                                           cellspacing="3"
                                                           class="panelLikeTable">
                                                        <tr>
                                                            <td>
                                                                <p:dataTable id="conditionTable"
                                                                             value="#{handlePersonAction.personSearches}"
                                                                             keepSaved="true"
                                                                             emptyMessage="#{bundle.empty_message}"
                                                                             sortMode="single"
                                                                             var="personSearch"
                                                                             rows="10"
                                                                             style="BORDER-COLLAPSE: collapse;text-align: center; width:100%;"
                                                                             rowClasses="ROW1,ROW2">
                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true"
                                                                                      value="#{personSearch.preCondition}"/>
                                                                    </p:column>

                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true"
                                                                                      value="#{personSearch.attributeName}"/>
                                                                    </p:column>

                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true"
                                                                                      value="#{personSearch.attributeValue}"/>
                                                                    </p:column>

                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true"
                                                                                      value="#{personSearch.postCondition}"/>
                                                                    </p:column>
                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <p:commandButton image="/images/delete.png"
                                                                                         title="delete"
                                                                                         execute="@this"
                                                                                         update="conditionTable"
                                                                                         limitRender="true"
                                                                                         action="#{handlePersonAction.removeCondition}"
                                                                                />
                                                                    </p:column>
                                                                    <f:facet name="footer">
                                                                        <p:dataScroller limitRender="true"
                                                                                        execute="@this"
                                                                                        update="conditionTable"
                                                                                        page="#{handleRuleAction.page}"/>
                                                                    </f:facet>
                                                                </p:dataTable>
                                                            </td>
                                                        </tr>
                                                        <tr valign="top">
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:commandButton value="#{bundle.search}"
                                                                                 action="#{handlePersonAction.search}"/>
                                                            </td>

                                                        </tr>
                                                    </table>
                                            </p:panel>
                                        </td>
                                        <td align="center" valign="bottom" nowrap="nowrap">
                                            <p:outputPanel ajaxRendered="true" id="pic_top">
                                                <p:graphicImage
                                                        value="/loadImage?id=#{handlePersonAction.currentPerson.id}"
                                                        styleClass="personPicture"
                                                        style="height: 150px;"
                                                        rendered="#{handlePersonAction.selectRow}"/>
                                            </p:outputPanel>
                                        </td>

                                    </tr>
                                </table>
                            </p:outputPanel>
                        </td>
                    </tr>


                    <tr valign="top">
                        <td align="#{me.align}" nowrap="nowrap" colspan="2">
                            <h:inputText converter="persianConverter" value="#{handlePersonAction.simpleValue}"/>
                            &#160;&#160;
                            <h:commandButton action="#{handlePersonAction.simpleSearch}" value="#{bundle.search}"/>

                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:commandButton action="#{handlePersonAction.exportExcel}" value="#{bundle.export}"/>
                        </td>
                    </tr>
                    <tr valign="top">
                        <td align="#{me.align}">
                            <p:outputPanel id="gallery" ajaxRendered="true"
                                           rendered="#{handlePersonAction.personAvailable}">
                                <table border="0" cellspacing="3" cellpadding="3" width="100%" dir="rtl">
                                    <tr valign="top">
                                        <td align="#{me.align}" nowrap="nowrap" colspan="2">
                                            <p:commandButton value="#{bundle.add}"
                                                             action="#{handlePersonAction.add}"
                                                             onclick="PF('PersonPanel').show()"/>
                                            &#160;&#160;

                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p:ring id="custom" value="#{handlePersonAction.persons}" var="person"
                                                    styleClass="image-ring"  easing="easeInOutBack">
                                                <p:graphicImage value="/loadImage?id=#{person.id}"
                                                                styleClass="personPicture"/>
                                                <br/>
                                                <table>
                                                    <tr>
                                                        <td>
                                                            <p:commandLink action="#{handlePersonAction.edit(person.id)}"
                                                                           title="#{bundle.edit}"
                                                                           onclick="PF('PersonPanel').show()"
                                                                           update="handlePersonForm:handlePanel, handlePersonForm:tabPanel:_personnelConfirm-password,detailPerson:tabPanel:renderdpicture">
                                                                <p:graphicImage value="/images/edit.png"/>
                                                            </p:commandLink>
                                                        </td>
                                                       </tr>
                                                </table>
                                            </p:ring>
                                        </td>
                                    </tr>

                                    <tr valign="middle">
                                        <td nowrap="nowrap" align="center" colspan="6">
                                            <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
                                            <table cellpadding="2" cellspacing="2" width="200px">
                                                <tr valign="middle">
                                                    <td align="right" nowrap="nowrap">
                                                        <h:outputLabel value="#{loop.index}"/>
                                                        <p:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),false,false,true)}"
                                                                disabled="#{handlePersonAction.firstPage}" title="first"
                                                                update="frm:gallery" value="&lt;&lt;&lt;"/>

                                                    </td>
                                                    <td align="left" nowrap="nowrap">

                                                        <p:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),true,false,false)}"
                                                                disabled="#{handlePersonAction.firstPage}"
                                                                title="previous"
                                                                update="frm:gallery" value="&lt;&lt;"/>
                                                    </td>
                                                    <td align="left" nowrap="nowrap">
                                                        <p:commandButton action="#{handlePersonAction.previous}"
                                                                         disabled="#{handlePersonAction.firstPage}"
                                                                         title="previous"
                                                                         update="frm:gallery" value="&lt;"/>
                                                    </td>
                                                    <td align="center" nowrap="nowrap">
                                                        <ui:repeat value="#{handlePersonAction.pageCount}" var="page"
                                                                   varStatus="loop"
                                                                   step="1">
                                                            <p:commandLink
                                                                    disabled="#{handlePersonAction.pageCount.get(loop.index)eq handlePersonAction.lastPageIndex}"
                                                                    update="frm:gallery"
                                                                    styleClass="textColor"
                                                                    action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),false,false,false)}"
                                                                    value="#{handlePersonAction.pageCount.get(loop.index)}"/> &#160;&#160;
                                                        </ui:repeat>
                                                    </td>
                                                    <td align="right" nowrap="nowrap">
                                                        <p:commandButton action="#{handlePersonAction.next}"
                                                                         disabled="#{handlePersonAction.lastPage}"
                                                                         title="next"
                                                                         update="frm:gallery" value="&gt;"/>

                                                    </td>
                                                    <td align="right" nowrap="nowrap">
                                                        <p:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),true,true,false)}"
                                                                disabled="#{handlePersonAction.lastPage}" title="next"
                                                                update="frm:gallery" value="&gt;&gt;"/>

                                                    </td>
                                                    <td align="right" nowrap="nowrap">
                                                        <p:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),false,true,true)}"
                                                                disabled="#{handlePersonAction.lastPage}" title="last"
                                                                update="frm:gallery" value="&gt;&gt;&gt;"/>

                                                    </td>

                                                </tr>
                                            </table>
                                        </td>
                                    </tr>

                                </table>
                            </p:outputPanel>
                        </td>
                    </tr>
                </table>

        </h:form>
    </ui:define>
</ui:composition>