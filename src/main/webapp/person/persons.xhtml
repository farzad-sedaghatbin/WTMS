<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">

        <!--<p:dialog header="PC Info" widgetVar="selectPDP" modal="true" showEffect="fade" hideEffect="fade" resizable="false">-->
            <!--<ui:include src="selectlist-pdp.xhtml"/>-->
        <!--</p:dialog>-->

        <!--<p:dialog header="PC Info" widgetVar="PersonPanel" modal="true" showEffect="fade" hideEffect="fade" resizable="false">-->
            <!--<ui:include src="handle-person.xhtml"/>-->
        <!--</p:dialog>-->

        <!--<p:dialog header="PC Info" widgetVar="rulePanel" modal="true" showEffect="fade" hideEffect="fade" resizable="false">-->
            <!--<ui:include src="../rule/handle-rule-edit.xhtml"/>-->
        <!--</p:dialog>-->

        <!--<p:dialog header="PC Info" widgetVar="resetPanel" modal="true" showEffect="fade" hideEffect="fade" resizable="false">-->
            <!--<ui:include src="reset-password.xhtml"/>-->
        <!--</p:dialog>-->

        <!--<p:dialog header="PC Info" widgetVar="AssignRulePanel" modal="true" showEffect="fade" hideEffect="fade" resizable="false">-->
            <!--<ui:include src="assign-person-rule.xhtml"/>-->
        <!--</p:dialog>-->

        <!--<p:dialog header="PC Info" widgetVar="PersonDetailPanel" modal="true" showEffect="fade" hideEffect="fade" resizable="false">-->
            <!--<ui:include src="detail-person.xhtml"/>-->
        <!--</p:dialog>-->

        <p:dialog header="PC Info" widgetVar="ConfirmationPanel" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
            <f:facet name="header">
                &#160;
            </f:facet>
            <h:form>

                <table border="0" cellpadding="3" cellspacing="3" class="panelLikeTable">
                    <tr valign="top">
                        <td nowrap="nowrap" align="center">
                            <h:outputText escape="true" value="delete message"/>
                        </td>
                    </tr>
                    <tr valign="top">
                        <td nowrap="nowrap" align="center">
                            <p:commandButton execute="@this" limitRender="true"
                                               action="#{handlePersonAction.doDelete}"
                                               render="globalMessages"
                                               value="yes"/>
                            &#160;
                            <p:commandButton execute="@this" limitRender="true" value="no"
                                               oncomplete="PF('ConfirmationPanel').hide()"/>
                        </td>
                    </tr>
                </table>
            </h:form>
        </p:dialog>

        <br/>

        <h:form dir="#{me.direction}" id="frm">
            <fieldset dir="#{me.direction}">

                <legend>
                    <h:outputText escape="true" value="person list"/>
                </legend>
                <table border="0" cellpadding="3" cellspacing="3" class="panelLikeTable">

                    <tr valign="top">
                        <td colspan="2" style="padding-bottom: 0; padding-bottom: 0">
                            <p:outputPanel id="advanceSearchID" ajaxRendered="true">
                                <table cellpadding="3" cellspacing="3" class="panelLikeTable">
                                    <tr>
                                        <td align="#{me.align}" nowrap="nowrap" valign="top" width="90%">
                                            <p:panel   header="Toggleable" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500" widgetVar="panel" style="margin-bottom:20px" dir="#{me.direction}"
                                                                 collapsed="#{view.viewId eq '/list-person.xhtml'}">
                                                <fieldset dir="#{me.direction}">

                                                    <legend>
                                                        <h:outputText escape="true" value="advance search"/>
                                                    </legend>
                                                    <table border="0" cellpadding="3" align="#{me.appositeAlign}" cellspacing="3"
                                                           class="panelLikeTable">

                                                        <tr valign="top">
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:selectOneMenu value="#{handlePersonAction.preCondition}">
                                                                    <f:selectItems value="#{handlePersonAction.preConditions}"/>
                                                                </h:selectOneMenu>
                                                            </td>
                                                            &#160;&#160;
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:selectOneMenu
                                                                        value="#{handlePersonAction.attributeName}">
                                                                    <f:selectItems
                                                                            value="#{handlePersonAction.attributeNames}"/>
                                                                </h:selectOneMenu>
                                                            </td>
                                                            &#160;&#160;
                                                            <td>
                                                                <h:inputText converter="persianConverter" value="#{handlePersonAction.attributeValue}"/>
                                                            </td>
                                                            &#160;&#160;
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:selectOneMenu
                                                                        value="#{handlePersonAction.postCondition}">
                                                                    <f:selectItems
                                                                            value="#{handlePersonAction.postConditions}"/>
                                                                </h:selectOneMenu>
                                                            </td>

                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <p:commandButton value="add condition"
                                                                                   action="#{handlePersonAction.addCondition}"
                                                                                   render="conditionTable,advanceSearchID"/>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                    <table border="0" cellpadding="3" align="#{me.appositeAlign}" cellspacing="3"
                                                           class="panelLikeTable">
                                                        <tr>
                                                            <td>
                                                                <p:dataTable id="conditionTable"
                                                                                value="#{handlePersonAction.personSearches}"
                                                                                keepSaved="true"
                                                                                noDataLabel="no result found"
                                                                                sortMode="single"
                                                                                var="personSearch"
                                                                                rows="10"
                                                                                style="BORDER-COLLAPSE: collapse;text-align: center; width:100%;"
                                                                                rowClasses="ROW1,ROW2">
                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true" value="#{personSearch.preCondition}"/>
                                                                    </p:column>

                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true" value="#{me.getValue(personSearch.attributeName)}"/>
                                                                    </p:column>

                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true" value="#{personSearch.attributeValue}"/>
                                                                    </p:column>

                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <h:outputText escape="true" value="#{personSearch.postCondition}"/>
                                                                    </p:column>
                                                                    <p:column>
                                                                        <f:facet name="header">
                                                                            <h:outputText escape="true" value=""/>
                                                                        </f:facet>
                                                                        <p:commandButton image="/images/delete.png"
                                                                                           title="delete"
                                                                                           execute="@this"
                                                                                           render="conditionTable,advanceSearchID"
                                                                                           limitRender="true"
                                                                                           action="#{handlePersonAction.removeCondition}"
                                                                                />
                                                                    </p:column>
                                                                    <f:facet name="footer">
                                                                        <p:dataScroller limitRender="true" execute="@this"
                                                                                           render="conditionTable"
                                                                                           page="#{handleRuleAction.page}"/>
                                                                    </f:facet>
                                                                </p:dataTable>
                                                            </td>
                                                        </tr>
                                                        <tr valign="top">
                                                            <td align="#{me.align}" nowrap="nowrap">
                                                                <h:commandButton value="search"
                                                                                 action="#{handlePersonAction.search}"
                                                                                 render="gallery,conditionTable,operationArea"/>
                                                            </td>

                                                        </tr>
                                                    </table>
                                                </fieldset>
                                            </p:panel>
                                        </td>
                                        <td align="center" valign="bottom" nowrap="nowrap">
                                            <p:outputPanel ajaxRendered="true" id="pic_top">
                                                <a4j:mediaOutput element="img" mimeType="image/png"
                                                                 value="#{handlePersonAction.currentPerson.id}"
                                                                 createContent="#{handlePersonAction.paint}"
                                                                 styleClass="personPicture"
                                                                 style="height: 150px;"
                                                                 cacheable="false" session="true"
                                                                 rendered="#{handlePersonAction.selectRow}"/>
                                            </p:outputPanel>
                                        </td>

                                    </tr>
                                </table>
                            </p:outputPanel>
                        </td>
                    </tr>

                    <tr valign="top">
                        <td nowrap="nowrap" colspan="2" style="padding-top: 0">
                            <table border="0" cellpadding="3" cellspacing="3" class="page_title">
                                <tr valign="top">
                                    <td nowrap="nowrap" class="page_title">
                                        <h:outputText escape="true" value="management"/>
                                    </td>
                                    <td align="center" nowrap="nowrap" class="page_title_separator" valign="bottom">
                                        <h:graphicImage rendered="#{me.direction eq 'rtl'}" value="/images/arrow-left.png"/>
                                        <h:graphicImage rendered="#{not me.direction eq 'rtl'}"
                                                        value="/images/arrow-right.png"/>
                                    </td>
                                    <td nowrap="nowrap" class="page_title">
                                        <h:outputText escape="true" value="person"/>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <tr valign="top">
                        <td nowrap="nowrap" align="#{me.align}" colspan="2">
                            <p:outputPanel ajaxRendered="true" id="operationArea">
                                <f:subview id="operationAreaSubview" rendered="#{handlePersonAction.selectRow}">
                                    <table border="0" cellpadding="3" cellspacing="3" class="toolbar panelLikeTable">
                                        <tr valign="top">
                                            <td nowrap="nowrap" style="padding-left: 15px; padding-right: 15px">
                                                <h:outputText escape="true" value="#{'سطر انتخاب شده:'}"/>
                                                &#160;&#160;
                                                <h:outputText escape="true" value="#{handlePersonAction.currentPerson.name}"/>
                                                &#160;
                                                <h:outputText escape="true" value="#{handlePersonAction.currentPerson.lastName}"/>
                                            </td>
                                            <td align="#{me.appositeAlign}" nowrap="nowrap" class="page_title_separator" valign="bottom">
                                            </td>


                                        </tr>
                                    </table>
                                </f:subview>
                            </p:outputPanel>
                            <h:inputHidden value="#{handlePersonAction.cardData}" id="cardDataInput"/>
                            <script type="text/javascript">
                                function readCardData() {
                                    try {
                                        var txt = document.app.getCardData();
                                        document.getElementById("frm:cardDataInput").value = txt;
                                        alert(txt);
                                    } catch (e) {
                                        alert(e);
                                    }
                                }
                            </script>
                        </td>
                    </tr>

                    <tr valign="top">
                        <td align="#{me.align}" nowrap="nowrap" colspan="2">
                            <p:commandButton value="add person"
                                               action="#{handlePersonAction.add}"
                                               execute="@this"
                                               limitRender="true"
                                               onclick="PF('PersonPanel').show()"
                                               rendered="#{me.hasPermission('ADD_PERSON')}"
                                               render="gallery, operationArea, handlePanel, pic_top, extrafiled1,extrafiled2,extrafiled3,extrafiled4"/>
                            &#160;&#160;
                            <h:commandButton action="#{handlePersonAction.exportExcel}" value="export"/>

                        </td>
                    </tr><tr valign="top">
                    <td align="#{me.align}" nowrap="nowrap" colspan="2">
                        <h:inputText converter="persianConverter" value="#{handlePersonAction.simpleValue}"/>
                        &#160;&#160;
                        <h:commandButton action="#{handlePersonAction.simpleSearch}"  render="gallery,operationArea" value="search"/>

                    </td>
                </tr>
                    <tr valign="top">
                        <td align="#{me.align}">
                            <p:outputPanel id="gallery" ajaxRendered="true" rendered="#{handlePersonAction.personAvailable}">
                                <table border="0" cellspacing="3" cellpadding="3" width="100%" dir="rtl">

                                    <p:ring id="custom" value="#{handlePersonAction.persons}" var="person" styleClass="image-ring" easing="easeInOutBack">
                                        <a4j:mediaOutput element="img" mimeType="image/png"
                                                         value="#{person.id}"
                                                         createContent="#{handlePersonAction.paint}"
                                                         styleClass="personPicture"
                                                         cacheable="false" session="true"/>
                                        <br />
                                        <p:commandButton image="/images/edit.png"
                                                           action="#{handlePersonAction.edit}"
                                                           title="edit"
                                                           onclick="PF('PersonPanel').show()"
                                                           update="handlePanel, _personnelConfirm-password,renderdpicture"/>
                                        <p:commandButton image="/images/assign-rule.png"
                                                           action="#{handlePersonAction.assignRule}"
                                                           title="assign rule"
                                                           update="handleAssignRulePanel,AssignRulePanel"
                                                           oncomplete="PF('AssignRulePanel').show()"/>
                                        <h:commandButton image="/images/assign-card.png"
                                                         title="assign card"
                                                         action="#{handlePersonAction.downloadJnlp}"/>
                                        <p:commandButton image="/images/pdp.png"
                                                           title="synch"
                                                           action="#{handlePDPAction.synch}"
                                                           onclick="PF('selectPDP').show()"
                                                           update="pdpFrm:selectPdpList"/>
                                        <p:commandButton image="/images/delete.png"
                                                           title="delete"
                                                           onclick="PF('ConfirmationPanel').show()"/>
                                        <p:commandButton image="/images/assign-rule.png"
                                                           action="#{handlePersonAction.editRule}"
                                                           title="edit rule"
                                                           update="handleRulePanel"
                                                           oncomplete="PF('rulePanel').show()"/>
                                        <p:commandButton image="/images/s_key.png"
                                                           update="handleResetPanel"
                                                           oncomplete="PF('resetPanel').show()"/>

                                    </p:ring>

                                    <tr valign="middle">
                                        <td nowrap="nowrap" align="center" colspan="6">
                                            <table cellpadding="2" cellspacing="2" width="200px">
                                                <tr valign="middle">
                                                    <td align="right" nowrap="nowrap">
                                                        <h:outputLabel value="#{loop.index}"/>
                                                        <a4j:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),false,false,true)}"
                                                                disabled="#{handlePersonAction.firstPage}" title="first"
                                                                execute="@this"
                                                                limitRender="true"
                                                                render="gallery" value="&lt;&lt;&lt;"/>

                                                    </td>
                                                    <td align="left" nowrap="nowrap">

                                                        <a4j:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),true,false,false)}"
                                                                disabled="#{handlePersonAction.firstPage}" title="previous"
                                                                execute="@this"
                                                                limitRender="true"
                                                                render="gallery" value="&lt;&lt;"/>
                                                    </td>
                                                    <td align="left" nowrap="nowrap">
                                                        <a4j:commandButton action="#{handlePersonAction.previous}"
                                                                           disabled="#{handlePersonAction.firstPage}" title="previous"
                                                                           execute="@this"
                                                                           limitRender="true"
                                                                           render="gallery" value="&lt;"/>
                                                    </td>
                                                    <td align="center" nowrap="nowrap">
                                                        <ui:repeat value="#{handlePersonAction.pageCount}" var="page" varStatus="loop"
                                                                   step="1">
                                                            <a4j:commandLink execute="@this"
                                                                             limitRender="true"
                                                                             disabled="#{handlePersonAction.pageCount.get(loop.index)eq handlePersonAction.lastPageIndex}"
                                                                             render="gallery"
                                                                             styleClass="textColor"
                                                                             action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),false,false,false)}"
                                                                             value="#{handlePersonAction.pageCount.get(loop.index)}"/> &#160;&#160;
                                                        </ui:repeat>
                                                    </td>
                                                    <td align="right" nowrap="nowrap">
                                                        <a4j:commandButton action="#{handlePersonAction.next}"
                                                                           disabled="#{handlePersonAction.lastPage}" title="next"
                                                                           execute="@this"
                                                                           limitRender="true"
                                                                           render="gallery" value="&gt;"/>

                                                    </td>
                                                    <td align="right" nowrap="nowrap">
                                                        <a4j:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),true,true,false)}"
                                                                disabled="#{handlePersonAction.lastPage}" title="next"
                                                                execute="@this"
                                                                limitRender="true"
                                                                render="gallery" value="&gt;&gt;"/>

                                                    </td>
                                                    <td align="right" nowrap="nowrap">
                                                        <a4j:commandButton
                                                                action="#{handlePersonAction.pageCordinator(handlePersonAction.pageCount.get(loop.index),false,true,true)}"
                                                                disabled="#{handlePersonAction.lastPage}" title="last"
                                                                execute="@this"
                                                                limitRender="true"
                                                                render="gallery" value="&gt;&gt;&gt;"/>

                                                    </td>

                                                </tr>
                                            </table>
                                        </td>
                                    </tr>

                                </table>
                            </p:outputPanel>
                        </td>
                    </tr>
                </table>
            </fieldset>

        </h:form>
    </ui:define>
</ui:composition>